name: Build (Linux manylinux_2_28 & Windows)

on:
  workflow_dispatch:
    inputs:
      version:
        description: "Build version label (e.g. v0.1.0)"
        required: true
        type: string

jobs:
  build:
    name: Build (${{ matrix.target }})
    runs-on: ${{ matrix.runner }}

    strategy:
      fail-fast: false
      matrix:
        include:
          - target: linux-amd64
            runner: ubuntu-latest
          - target: windows-amd64
            runner: windows-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # ---------------- LINUX (manylinux_2_28 + shared python) ----------------
      - name: Build Linux binary in manylinux_2_28 (shared Python)
        if: matrix.target == 'linux-amd64'
        shell: bash
        run: |
          set -euxo pipefail

          VERSION="${{ inputs.version }}"
          ASSET="dsutil-${VERSION}-linux-amd64"

          docker run --rm \
            -v "${PWD}:/io" \
            -w /io \
            quay.io/pypa/manylinux_2_28_x86_64 \
            bash -lc '
              set -euxo pipefail

              # Устанавливаем Python 3.12 с libpython3.12.so (enable-shared)
              # manylinux_2_28 основан на Debian/U
